package database;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import model.E_ham;
import model.main;

public class EhamDAO {

	public EhamDAO() {
	}

	public void loadEhamData() {

		String sql = "select * from ehamdata;";
		try (Connection conn = GetData.getConnection();
				PreparedStatement st = conn.prepareStatement(sql);) {

			ResultSet rs = st.executeQuery();

			while (rs.next()) {
				String name = rs.getString("name");
				String[] MHD = { "stamina", "power", "guts", "skill" };
				int[][] M = new int[3][MHD.length];
				for (int i = 0; i < 3; i++) {
					for (int j = 0; j < MHD.length; j++) {
						M[i][j] = rs.getInt(MHD[j]);
					}
				}
				main.EH1 = new E_ham(name, M[0][0], M[0][1], M[0][2], M[0][3]);
				main.EH2 = new E_ham(name, M[1][0], M[1][1], M[1][2], M[1][3]);
				main.EH3 = new E_ham(name, M[2][0], M[2][1], M[2][2], M[2][3]);
			}
			System.out.println("EhamData取得成功");

			st.close();
			conn.close();

		} catch (SQLException e) {
			System.err.println("EhamData取得失敗");
		}

	}

	public void saveEhamData() {

		String sql = "UPDATE Ehamdata SET name=\"" + main.H.getName() +
				"\", stamina=\"" + main.H.getStamina() +
				"\", power=\"" + main.H.getPower() +
				"\", guts=\"" + main.H.getGuts() +
				"\", skill=\"" + main.H.getSkill() +
				"\" WHERE ID= 1;";

		try {
			Connection conn = GetData.getConnection();
			Statement st = conn.createStatement();
			st.executeUpdate(sql);
			System.out.println("EhamData保存成功");
			st.close();
			conn.close();

		} catch (SQLException e) {
			System.err.println("EhamData保存失敗");
		}

	}

	public void initialized() {

		String CTSQL = "CREATE TABLE Ehamdata (" +
				"ID INT," +
				"name VARCHAR(20)," +
				"stamina INT," +
				" power INT," +
				"guts INT," +
				" skill INT" +
				" );";
		String INSQL = "INSERT INTO EhamData VALUES (1, \"ハム青龍\", 15, 15, 15, 15)," +
				"(2, \"ハム鵬\", 25, 25, 25, 25)," +
				"(3, \"ハム道山\", 50, 50, 50, 50);";

		try (Connection conn = GetData.getConnection();) {

			Statement st = conn.createStatement();
			st.executeUpdate(CTSQL);
			PreparedStatement ps = conn.prepareStatement(INSQL);
			ps.executeUpdate();
			System.out.println("EhamData初期化成功");

		} catch (SQLException e) {
			System.err.println("EhamData初期化失敗");
		}
	}
}
